## üìö Kindle Clipping Parser

This Node.js script processes the raw `my-clippings.txt` file generated by Kindle devices, splits the content by book, and converts highlights and notes into structured Markdown files. It uses a custom hierarchy system defined by user notes to structure the generated documents.

-----

## ‚ú® Features

  * **Book-Specific Files:** Automatically creates a dedicated Markdown file for each book, named `[Author Last Name] - [Book Title].md`.
  * **YAML Front Matter:** Adds standard YAML front matter to each file, including:
      * `title`
      * `author` (Full Name)
      * `last_interaction` (The timestamp of the latest highlight or note added to the book).
  * **Custom Hierarchy Control:** Interprets numeric user notes as Markdown heading levels, allowing you to structure your highlights logically.
      * A note containing `2` sets the subsequent highlight to use an `## H2` heading.
  * **Default Behavior (Level 0):** Highlights not preceded by a hierarchy note are rendered as **Markdown Blockquotes (`>`)**, ideal for raw quotations.
  * **Idempotency:** The script uses a two-pass approach to ensure files are overwritten and recreated cleanly on every run.

## üõ†Ô∏è Setup and Installation

### Prerequisites

You need to have **Node.js** installed on your system (version 14 or higher recommended).

### Steps

1.  **Clone the Repository:** (Assuming this script is in your repo)
    ```bash
    git clone [your-repository-url]
    cd [your-repository-name]
    ```
2.  **Place the Input File:** Copy your Kindle's `My Clippings.txt` file into the root directory of this project and ensure it is named:
    ```
    my-clippings.txt
    ```

## üöÄ Usage

Execute the script from your terminal:

```bash
node parseClippings.js
```

### Output

The script will create a new directory named `markdown_notes/` in the project root. This directory will contain all your organized Markdown files, like:

```
markdown_notes/
‚îú‚îÄ‚îÄ Zhuo - The Making of a Manager.md
‚îú‚îÄ‚îÄ Clear - Atomic Habits.md
‚îî‚îÄ‚îÄ ...
```


## üîå Mounting the Kindle on a Linux Server

If you are running this script on a Linux server (or a headless environment) and need to transfer the `my-clippings.txt` file directly from your Kindle, you will typically need to manually mount the device.

Your Kindle device presents itself as a standard USB Mass Storage Device.

### 1\. Identify the Kindle Device

After connecting your Kindle via USB, use the `dmesg` command to see recent kernel messages, or `fdisk -l` to list storage devices. The Kindle will usually appear as a device like `/dev/sdb`, `/dev/sdc`, or similar.

```bash
# Check kernel messages for device name
dmesg | tail

# Example output snippet:
# [ 1234.567890] sd 2:0:0:0: [sdb] Attached SCSI removable disk
```

In the example above, the device is likely `/dev/sdb`.

### 2\. Create a Mount Point

Create a directory where the Kindle's file system will be accessible.

```bash
# Create the directory in a suitable location (e.g., /mnt)
sudo mkdir /mnt/kindle
```

### 3\. Mount the Kindle

Use the `mount` command with the identified device path and the created mount point. The Kindle's file system is typically **FAT32** (`vfat`).

```bash
# Syntax: sudo mount -t [filesystem_type] [device_path] [mount_point]
sudo mount -t vfat /dev/sdb /mnt/kindle
```

> **Note:** Replace `/dev/sdb` with the actual device name identified in Step 1. If your Kindle has multiple partitions, ensure you mount the correct one containing the clippings.

### 4\. Locate and Copy the File

Once mounted, you can access the files. The `my-clippings.txt` file is usually located in the root directory of the Kindle partition.

```bash
# Navigate to the mount point
cd /mnt/kindle

# Copy the clippings file to your script's directory
cp "My Clippings.txt" /path/to/your/script/my-clippings.txt

# Return to your script directory
cd /path/to/your/script/
```

### 5\. Unmount the Device

It is crucial to **unmount** the Kindle before physically disconnecting it to prevent data corruption.

```bash
# Unmount the device
sudo umount /mnt/kindle
```

You can now safely disconnect your Kindle from the server.

-----

### ‚ö†Ô∏è Troubleshooting

If you encounter a "device is busy" error when trying to unmount, ensure no processes are accessing the `/mnt/kindle` directory. You can use the `lsof` command to identify and kill the processes.

```bash
# Find processes using the mount point
lsof /mnt/kindle
```

## üìñ Hierarchy Logic

The script interprets your custom notes based on the following rules:

| Clipping Type | Content | Action | Resulting Markdown |
| :--- | :--- | :--- | :--- |
| **Note** | `3` | Sets the next highlight's level to H3. | *No output, state updated.* |
| **Highlight** | `Ask for Feedback` | Uses the current hierarchy level (H3). | `### Ask for Feedback` |
| **Note** | *Any non-numeric content* | Ignored for hierarchy. | *No output, state unchanged.* |
| **Highlight** | `Be prepared` | Uses the default hierarchy level (0). | `> Be prepared` |
| **Note** | `1` | Sets the next highlight's level to H1. | *No output, state updated.* |

**Crucial Reset Rule:** After any highlight is written to a file, the hierarchy level for that book is immediately reset back to the **Default Level 0 (Blockquote)**.

## ‚öôÔ∏è Configuration

You can easily adjust the script's behavior by editing the constants at the top of `parseClippings.js`:

| Constant | Description | Default Value |
| :--- | :--- | :--- |
| `INPUT_FILE` | The name of the Kindle clipping file. | `'my-clippings.txt'` |
| `OUTPUT_DIR` | The folder where the Markdown files will be saved. | `'markdown_notes'` |
| `DELIMITER` | The sequence used to separate clippings. | `'=========='` |
| `DEFAULT_HEADING_LEVEL` | Level used when no note is set. `0` = Blockquote. | `0` |
| `MAX_HEADING_LEVEL` | Highest valid heading level (H1-H6). | `6` |
